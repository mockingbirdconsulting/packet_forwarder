machine:
  environment:
    RPXC_IMAGE: sdthirlwall/raspberry-pi-cross-compiler
    RPXC_SCRIPT: "/home/ubuntu/bin/rpxc"

  services:
    - docker

## Customize checkout
checkout:
  post:
    - git submodule sync
    - git submodule update --init # use submodules


dependencies:
  override:
    - cd rpicc && ./build.sh
    - docker run --rm $RPXC_IMAGE > $RPXC_SCRIPT
    - chmod +x $RPXC_SCRIPT

test:
  override:
    - rpxc sh -c 'CFLAGS=--sysroot=$SYSROOT ./configure --host=$HOST'
    - rpxc "apt-get install build-essential && dpkg-buildpackage -us -uc"
